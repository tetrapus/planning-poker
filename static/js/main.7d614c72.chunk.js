(this["webpackJsonpplanning-poker"]=this["webpackJsonpplanning-poker"]||[]).push([[0],{35:function(e,t,n){},37:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t),n.d(t,"initFirebase",(function(){return P}));var c=n(5),a=n.n(c),r=n(25),i=n.n(r),s=(n(35),n(20),n(30),n(26)),o=n(12),l=n.n(o),d=n(17),u=n(11),j=n(18),b=(n(37),n(10)),h=n(27),f=n(14),p=n(28),m=n(3),x={signInFlow:"popup",callbacks:{signInSuccessWithAuthResult:function(){return!1}},signInOptions:[b.a.auth.GoogleAuthProvider.PROVIDER_ID]};function O(){return Object(m.jsxs)("div",{style:{marginTop:"50vh",transform:"translateY(-100%)",flexGrow:1,margin:"auto"},children:[Object(m.jsx)("h1",{children:"Planning Poker"}),Object(m.jsx)(p.StyledFirebaseAuth,{uiConfig:x,firebaseAuth:b.a.auth()})]})}function v(){return(v=Object(j.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.firestore().collection("game").add({owner:t.uid,name:"".concat(t.displayName,"'s Planning Poker"),activeTask:null,deck:[1,2,3,5,8,13,21],created:b.a.firestore.Timestamp.now()});case 2:(n=e.sent).collection("members").doc(t.uid).set({name:t.displayName}),window.location.search=n.id;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){var t=e.user,n=Object(f.a)(b.a.firestore().collection("game").orderBy("created","desc").limit(10)),c=Object(u.a)(n,1)[0];return Object(m.jsxs)("div",{style:{margin:"auto"},children:[Object(m.jsxs)("h1",{children:["Welcome, ",t.displayName,"!"]}),Object(m.jsx)("button",{onClick:function(){return function(e){return v.apply(this,arguments)}(t)},children:"Start a new game"}),Object(m.jsx)("h2",{children:"Join Game"}),Object(m.jsx)("div",{children:c?c.docs.map((function(e){return Object(m.jsxs)("div",{onClick:function(){return window.location.search=e.id},className:"GameEntry",children:[e.data().name," (",e.data().created.toDate().toLocaleString(),")"]})})):null})]})}function k(e){return e.length?e.reduce((function(e,t){return e+t}))/e.length:0}function y(e){e.game;var t=e.user,n=e.activeTask,c=e.members,a=e.scores,r=(a?a.data():null)||{},i=n.data().revealed;if(c)return Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"20vw",fontSize:"18px"},children:[Object(m.jsx)("div",{children:c.docs.map((function(e){var n=t.uid===e.id;return Object(m.jsxs)("div",{style:Object(d.a)(Object(d.a)({},n?{fontWeight:"bold"}:{}),{margin:"8px 12px",display:"flex"}),children:[Object(m.jsxs)("div",{style:{marginRight:"auto"},children:[e.data().name," "]}),Object(m.jsx)("div",{children:n&&r?r[t.uid]:i?r[e.id]:r[e.id]?"\u2714\ufe0f":""})]})}))}),Object(m.jsx)("div",{children:i?Object(m.jsxs)(m.Fragment,{children:["Average:"," ",Math.round(k(Object.values(r).filter((function(e){return"?"!==e}))))]}):Object(m.jsxs)(m.Fragment,{children:[Object.values(r).length,"/",c.docs.length," Responses"]})})]})}function w(e){var t=e.user,n=b.a.firestore().collection("game").doc(window.location.search.slice(1)),a=Object(f.b)(n),r=Object(u.a)(a,2),i=r[0],o=r[1],d=Object(f.a)(n.collection("tasks").orderBy("idx")),h=Object(u.a)(d,2),p=h[0],x=h[1],O=Object(c.useState)(""),v=Object(u.a)(O,2),g=v[0],w=v[1],T=Object(f.a)(n.collection("members")),S=Object(u.a)(T,2),C=S[0],I=S[1],P=Object(c.useState)(),N=Object(u.a)(P,2),D=N[0],A=N[1],F=Object(c.useState)(""),E=Object(u.a)(F,2),G=E[0],R=E[1],M=Object(f.a)(n.collection("scores")),B=Object(u.a)(M,2),L=B[0],J=B[1];if(o||x||I)return null;var K=i.data().activeTask,W=K&&!x?p.docs.find((function(e){return e.id===K})):null,z=J?null:L.docs.find((function(e){return e.id===K})),Y=p.docs.findIndex((function(e){return e.id===K}));return console.log(G),C.docs.find((function(e){return e.id===t.uid}))?Object(m.jsxs)("div",{style:{display:"flex",backgroundColor:"#f0f0f0"},children:[Object(m.jsxs)("div",{style:{width:"20vw"},children:[Object(m.jsx)("h1",{children:"Tasks"}),Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[p?p.docs.map((function(e){return Object(m.jsx)("div",{style:K===e.id?{fontWeight:"bold"}:{color:"grey"},onClick:function(){i.ref.set({activeTask:e.id},{merge:!0})},className:"TaskEntry",children:e.data().name})})):null,Object(m.jsx)("input",{placeholder:"+ Add Task",onChange:function(e){return w(e.value)},value:g,style:{marginTop:16},onKeyPress:function(){var e=Object(j.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,n.collection("tasks").add({name:t.currentTarget.value,revealed:!1,idx:p.docs.length});case 3:w("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),document.phabricatorGetEpic?Object(m.jsx)("input",{placeholder:"Ticket",value:G,onChange:function(e){return R(e.currentTarget.value)},pattern:"T\\d+",type:"text",onKeyPress:function(){var e=Object(j.a)(l.a.mark((function e(t){var c,a,r,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key||!t.currentTarget.checkValidity()){e.next=23;break}return e.next=3,document.phabricatorGetEpic(G);case 3:c=e.sent,a=p.docs.length,r=Object(s.a)(c),e.prev=6,r.s();case 8:if((i=r.n()).done){e.next=14;break}return o=i.value,e.next=12,n.collection("tasks").add({name:"T".concat(o.id,": ").concat(o.fields.name),revealed:!1,idx:a++});case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:R("");case 23:case"end":return e.stop()}}),e,null,[[6,16,19,22]])})));return function(t){return e.apply(this,arguments)}}()}):null]})]}),Object(m.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"60vw",background:"white",height:"auto"},children:W?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{style:{padding:"38px"},children:W.data().name}),Object(m.jsx)("div",{style:{margin:"32px"},children:(i.data().deck,Object(m.jsx)("input",{placeholder:"Score",pattern:"\\d+"}))}),Object(m.jsxs)("div",{children:[W.data().revealed&&i.data().owner===t.uid?Object(m.jsxs)("div",{children:[Object(m.jsx)("button",{onClick:function(){W.ref.set({revealed:!1},{merge:!0})},className:"Secondary",children:"Hide"}),Object(m.jsx)("button",{disabled:Y===p.docs.length-1,onClick:function(){i.ref.set({activeTask:p.docs[Y+1].id},{merge:!0})},children:"Next"})]}):Object(m.jsxs)("div",{children:[Object(m.jsx)("button",{disabled:Y===p.docs.length-1,onClick:function(){i.ref.set({activeTask:p.docs[Y+1].id},{merge:!0})},className:"Secondary",children:"Skip"}),Object(m.jsx)("button",{onClick:function(){W.ref.set({revealed:!0},{merge:!0}),A(z?Math.round(k(Object.values(z.data()).filter((function(e){return"?"!==e})))):0)},children:"Reveal"})]}),document.phabricatorSetPoints&&W&&W.data().name.match(/^T\d+/)?Object(m.jsxs)("div",{style:{marginTop:"32px"},children:[Object(m.jsx)("input",{placeholder:"Points",value:D,onChange:function(e){return A(e.currentTarget.value)}}),Object(m.jsx)("button",{onClick:Object(j.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(D),n=parseInt(W.data().name.match(/^T(\d+)/)[1]),e.next=4,document.phabricatorSetPoints(n,t);case 4:A("");case 5:case"end":return e.stop()}}),e)}))),className:"InputButton",children:"Set Points"})]}):null]})]}):Object(m.jsx)("button",{disabled:x||!p.docs.length,onClick:function(){return i.ref.set({activeTask:p.docs[0].id},{merge:!0})},children:"Start Game"})}),W?Object(m.jsx)(y,{game:i,user:t,activeTask:W,members:I?null:C,scores:z}):null]}):Object(m.jsx)("div",{style:{display:"flex",minHeight:"100vh"},children:Object(m.jsx)("button",{onClick:function(){return n.collection("members").doc(t.uid).set({name:t.displayName})},style:{transform:"translateY(-100%)",margin:"auto"},children:"Join Session"})})}function T(e){var t,n=e.id,c=e.user,a=b.a.firestore().collection("settings").doc(c.uid),r=Object(f.a)(a),i=Object(u.a)(r,1)[0],s=null===i||void 0===i||null===(t=i.data())||void 0===t?void 0:t.darkMode;return Object(m.jsxs)("div",{style:Object(d.a)(Object(d.a)({},s?{filter:"invert(0.95)"}:{}),{display:"flex",flexGrow:1}),children:[n?Object(m.jsx)(w,{id:n,user:c}):Object(m.jsx)(g,{user:c}),Object(m.jsx)("button",{className:"Secondary",style:{position:"absolute",right:0,bottom:0,color:"grey"},onClick:function(){a.set({darkMode:!s},{merge:!0})},children:s?"Light Mode":"Dark Mode"})]})}var S=function(){var e=Object(h.a)(b.a.auth()),t=Object(u.a)(e,1)[0],n=window.location.search?window.location.search.slice(1):null;return Object(m.jsx)("div",{className:"App",children:t?Object(m.jsx)(T,{id:n,user:t}):Object(m.jsx)(O,{})})},C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,53)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))},I=!1;function P(){if(!I){b.a.initializeApp({apiKey:"AIzaSyDd-g1pxYDd5wiI-8aRLKO7k0hpIA2ogO0",authDomain:"planning-poker-27ef5.firebaseapp.com",databaseURL:"https://planning-poker-27ef5.firebaseio.com",projectId:"planning-poker-27ef5",storageBucket:"planning-poker-27ef5.appspot.com",messagingSenderId:"359210422354",appId:"1:359210422354:web:32c9e1671ff01dddb68f8b"}),I=!0}}P(),i.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(S,{})}),document.getElementById("root")),C()}},[[52,1,2]]]);
//# sourceMappingURL=main.7d614c72.chunk.js.map