(this["webpackJsonpplanning-poker"]=this["webpackJsonpplanning-poker"]||[]).push([[0],{35:function(e,t,n){},37:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t),n.d(t,"initFirebase",(function(){return D}));var r=n(6),a=n.n(r),c=n(25),i=n.n(c),s=(n(35),n(17)),o=n(30),u=n(26),l=n(5),d=n.n(l),f=n(19),p=n(13),j=n(11),b=(n(37),n(10)),h=n(27),x=n(15),v=n(28),m=n(3),O={signInFlow:"popup",callbacks:{signInSuccessWithAuthResult:function(){return!1}},signInOptions:[b.a.auth.GoogleAuthProvider.PROVIDER_ID]};function g(){return Object(m.jsxs)("div",{style:{marginTop:"50vh",transform:"translateY(-100%)",flexGrow:1,margin:"auto"},children:[Object(m.jsx)("h1",{children:"Planning Poker"}),Object(m.jsx)(v.StyledFirebaseAuth,{uiConfig:O,firebaseAuth:b.a.auth()})]})}function k(e,t){return y.apply(this,arguments)}function y(){return(y=Object(j.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.a.firestore().collection("game").doc(),e.next=3,r.set(a,{owner:t.uid,name:"".concat(t.displayName,"'s Planning Poker"),activeTask:null,deck:n?null:[1,2,3,5,8,13,21,34,55],created:b.a.firestore.Timestamp.now()});case 3:return e.next=5,r.set(a.collection("members").doc(t.uid),{name:t.displayName});case 5:return e.abrupt("return",a.id);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:r=e.sent,window.location.search=r;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){var t=e.user,n=Object(x.a)(b.a.firestore().collection("game").orderBy("created","desc").limit(10)),r=Object(p.a)(n,1)[0];return Object(m.jsxs)("div",{style:{margin:"auto"},children:[Object(m.jsxs)("h1",{children:["Welcome, ",t.displayName,"!"]}),Object(m.jsx)("button",{onClick:function(){return k(t,!1)},children:"Start a new game"}),Object(m.jsx)("button",{className:"Secondary",onClick:function(){return k(t,!0)},children:"Freestyle"}),Object(m.jsx)("h2",{children:"Join Game"}),Object(m.jsx)("div",{children:r?r.docs.map((function(e){return Object(m.jsxs)("div",{onClick:function(){return window.location.search=e.id},className:"GameEntry",children:[e.data().name," (",e.data().created.toDate().toLocaleString(),")"]})})):null})]})}function T(e){return e.length?e.reduce((function(e,t){return e+t}))/e.length:0}function C(e){e.game;var t=e.user,n=e.activeTask,r=e.members,a=e.scores,c=(a?a.data():null)||{},i=n.data().revealed;if(r)return Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"column",fontSize:"18px"},className:"Column",children:[Object(m.jsx)("div",{children:r.docs.map((function(e){var n=t.uid===e.id;return Object(m.jsxs)("div",{style:Object(f.a)(Object(f.a)({},n?{fontWeight:"bold"}:{}),{margin:"8px 12px",display:"flex"}),children:[Object(m.jsxs)("div",{style:{marginRight:"auto"},children:[e.data().name," "]}),Object(m.jsx)("div",{children:n&&c?c[t.uid]:i?c[e.id]:c[e.id]?"\u2714\ufe0f":""})]})}))}),Object(m.jsx)("div",{children:i?Object(m.jsxs)(m.Fragment,{children:["Average:"," ",Math.round(T(Object.values(c).filter((function(e){return"?"!==e}))))]}):Object(m.jsxs)(m.Fragment,{children:[Object.values(c).length,"/",r.docs.length," Responses"]})})]})}function S(e){var t=e.user,n=Object(r.useState)("passive"),a=Object(p.a)(n,2),c=a[0],i=a[1],l=Object(r.useState)(null),f=Object(p.a)(l,2),h=f[0],v=f[1],O=b.a.firestore().collection("game").doc(window.location.search.slice(1)),g=Object(x.b)(O),k=Object(p.a)(g,2),y=k[0],w=k[1],S=Object(x.a)(O.collection("tasks").orderBy("idx")),N=Object(p.a)(S,2),I=N[0],A=N[1],P=Object(r.useState)(""),D=Object(p.a)(P,2),E=D[0],F=D[1],R=Object(x.a)(O.collection("members")),G=Object(p.a)(R,2),B=G[0],M=G[1],L=Object(r.useState)(),K=Object(p.a)(L,2),Y=K[0],J=K[1],W=Object(r.useState)(""),z=Object(p.a)(W,2),V=z[0],H=z[1],U=Object(x.a)(O.collection("scores")),_=Object(p.a)(U,2),q=_[0],Q=_[1];if(w||A||M)return null;var X=null!==h&&void 0!==h?h:y.data().activeTask,Z=X&&!A?I.docs.find((function(e){return e.id===X})):null,$=Q?null:q.docs.find((function(e){return e.id===X})),ee=I.docs.findIndex((function(e){return e.id===X}));return console.log(V),B.docs.find((function(e){return e.id===t.uid}))?Object(m.jsxs)("div",{style:{display:"flex",backgroundColor:"#f0f0f0"},className:"Outer",children:[Object(m.jsxs)("div",{style:{textAlign:"start",margin:8},className:"Column",children:[Object(m.jsx)("h1",{children:"Tasks"}),Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[I?I.docs.map((function(e){return Object(m.jsx)("div",{style:X===e.id?{fontWeight:"bold"}:{color:"grey"},onClick:function(){"passive"!==c&&("paused"!==c?b.a.firestore().runTransaction(function(){var t=Object(j.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.set(y.ref,{activeTask:e.id},{merge:!0});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):v(e.id))},className:"passive"===c?"TaskEntry TaskEntry-passive":"TaskEntry",children:e.data().name})})):null,Object(m.jsx)("input",{placeholder:"+ Add Task",onChange:function(e){return F(e.value)},value:E,style:{marginTop:16},onKeyPress:function(){var e=Object(j.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return n=t.currentTarget.value,e.next=4,b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(O.collection("tasks").doc(),{name:n,revealed:!1,idx:I.docs.length});case 2:F("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),document.phabricatorGetEpic?Object(m.jsx)("input",{placeholder:"Ticket",value:V,onChange:function(e){return H(e.currentTarget.value)},pattern:"T\\d+",type:"text",onKeyPress:function(){var e=Object(j.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key||!t.currentTarget.checkValidity()){e.next=7;break}return e.next=3,document.phabricatorGetEpic(V);case 3:return n=e.sent,r=I.docs.length,e.next=7,b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){var a,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(u.a)(n),e.prev=1,a.s();case 3:if((c=a.n()).done){e.next=9;break}return i=c.value,e.next=7,t.set(O.collection("tasks").doc(),{name:"T".concat(i.id,": ").concat(i.fields.name),revealed:!1,idx:r++});case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),a.e(e.t0);case 14:return e.prev=14,a.f(),e.finish(14);case 17:H("");case 18:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):null]})]}),Object(m.jsx)("div",{style:{display:"flex",flexDirection:"column",background:"white",height:"auto"},className:"Content",children:Z?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{style:{padding:"38px"},children:Z.data().name}),Object(m.jsx)("div",{style:{margin:"32px"},children:y.data().deck?[].concat(Object(o.a)(y.data().deck),["?"]).map((function(e){return Object(m.jsx)("button",{className:"Card ".concat($&&$.data()&&e===$.data()[t.uid]?"SelectedCard":""),onClick:function(){b.a.firestore().runTransaction(function(){var n=Object(j.a)(d.a.mark((function n(r){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.set(y.ref.collection("scores").doc(X),Object(s.a)({},t.uid,e),{merge:!0});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},children:e})})):Object(m.jsx)("input",{placeholder:"Score",pattern:"\\d+",onKeyPress:function(){var e=Object(j.a)(d.a.mark((function e(n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==n.key||!n.currentTarget.checkValidity()){e.next=4;break}return r=n.currentTarget.value,e.next=4,b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.set(y.ref.collection("scores").doc(X),Object(s.a)({},t.uid,parseInt(r)),{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}),Object(m.jsxs)("div",{children:["passive"===c?Object(m.jsxs)("div",{children:["You are voting."," ",Object(m.jsx)("span",{onClick:function(){return i("active")},className:"Anchor",children:"Take over the session"})]}):Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{style:{marginBottom:"16px"},children:["You are ","paused"===c?"not":""," ","controlling the session."," ","active"===c?Object(m.jsx)("span",{onClick:function(){i("paused"),v(null)},className:"Anchor",children:"Pause"}):Object(m.jsx)("span",{onClick:function(){i("active"),v(null)},className:"Anchor",children:"Resume"})," ","or"," ",Object(m.jsx)("span",{onClick:function(){i("passive"),v(null)},className:"Anchor",children:"Abdicate"})]}),Z.data().revealed&&y.data().owner===t.uid?Object(m.jsxs)("div",{children:[Object(m.jsx)("button",{onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(Z.ref,{revealed:!1},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},className:"Secondary",children:"Hide"}),Object(m.jsx)("button",{disabled:ee===I.docs.length-1,onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(y.ref,{activeTask:I.docs[ee+1].id},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},children:"Next"})]}):Object(m.jsxs)("div",{children:[Object(m.jsx)("button",{disabled:ee===I.docs.length-1,onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(y.ref,{activeTask:I.docs[ee+1].id},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},className:"Secondary",children:"Skip"}),Object(m.jsx)("button",{onClick:Object(j.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(Z.ref,{revealed:!0},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:J($?Math.round(T(Object.values($.data()).filter((function(e){return"?"!==e})))):0);case 3:case"end":return e.stop()}}),e)}))),children:"Reveal"})]})]}),document.phabricatorSetPoints&&Z&&Z.data().name.match(/^T\d+/)?Object(m.jsxs)("div",{style:{marginTop:"32px"},children:[Object(m.jsx)("input",{placeholder:"Points",value:Y,onChange:function(e){return J(e.currentTarget.value)}}),Object(m.jsx)("button",{onClick:Object(j.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(Y),n=parseInt(Z.data().name.match(/^T(\d+)/)[1]),e.next=4,document.phabricatorSetPoints(n,t);case 4:J("");case 5:case"end":return e.stop()}}),e)}))),className:"InputButton",children:"Set Points"})]}):null]})]}):Object(m.jsx)("button",{disabled:A||!I.docs.length,onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(y.ref,{activeTask:I.docs[0].id},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},children:"Start Game"})}),Z?Object(m.jsx)(C,{game:y,user:t,activeTask:Z,members:M?null:B,scores:$}):null]}):Object(m.jsx)("div",{style:{display:"flex",minHeight:"100vh"},children:Object(m.jsx)("button",{onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.set(O.collection("members").doc(t.uid),{name:t.displayName});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},style:{transform:"translateY(-100%)",margin:"auto"},children:"Join Session"})})}function N(e){var t,n=e.id,r=e.user,a=b.a.firestore().collection("settings").doc(r.uid),c=Object(x.a)(a),i=Object(p.a)(c,1)[0],s=null===i||void 0===i||null===(t=i.data())||void 0===t?void 0:t.darkMode;return Object(m.jsxs)("div",{style:Object(f.a)(Object(f.a)({},s?{filter:"invert(0.95)"}:{}),{display:"flex",flexGrow:1,background:"white"}),children:[n?Object(m.jsx)(S,{id:n,user:r}):Object(m.jsx)(w,{user:r}),Object(m.jsx)("button",{className:"Secondary",style:{position:"absolute",right:0,bottom:0,color:"grey"},onClick:function(){b.a.firestore().runTransaction(function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.set(a,{darkMode:!s},{merge:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},children:s?"Light Mode":"Dark Mode"})]})}var I=function(){var e=Object(h.a)(b.a.auth()),t=Object(p.a)(e,1)[0],n=window.location.search?window.location.search.slice(1):null;return Object(m.jsx)("div",{className:"App",children:t?Object(m.jsx)(N,{id:n,user:t}):Object(m.jsx)(g,{})})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,53)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))},P=!1;function D(){if(!P){b.a.initializeApp({apiKey:"AIzaSyDd-g1pxYDd5wiI-8aRLKO7k0hpIA2ogO0",authDomain:"planning-poker-27ef5.firebaseapp.com",databaseURL:"https://planning-poker-27ef5.firebaseio.com",projectId:"planning-poker-27ef5",storageBucket:"planning-poker-27ef5.appspot.com",messagingSenderId:"359210422354",appId:"1:359210422354:web:32c9e1671ff01dddb68f8b"}),P=!0}}D(),i.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(I,{})}),document.getElementById("root")),A()}},[[52,1,2]]]);
//# sourceMappingURL=main.60c13f6f.chunk.js.map